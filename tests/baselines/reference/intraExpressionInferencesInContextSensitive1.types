//// [tests/cases/conformance/types/typeRelationships/typeInference/intraExpressionInferencesInContextSensitive1.ts] ////

=== intraExpressionInferencesInContextSensitive1.ts ===
// https://github.com/microsoft/TypeScript/issues/60720

type Options<TContext> = {
>Options : Options<TContext>
>        : ^^^^^^^^^^^^^^^^^

  onStart?: () => TContext;
>onStart : (() => TContext) | undefined
>        : ^^^^^^^        ^^^^^^^^^^^^^

  onEnd?: (context: TContext) => void;
>onEnd : ((context: TContext) => void) | undefined
>      : ^^       ^^        ^^^^^    ^^^^^^^^^^^^^
>context : TContext
>        : ^^^^^^^^

};

function create<TContext>(builder: (arg: boolean) => Options<TContext>) {
>create : <TContext>(builder: (arg: boolean) => Options<TContext>) => Options<TContext>
>       : ^        ^^       ^^                                   ^^^^^^^^^^^^^^^^^^^^^^
>builder : (arg: boolean) => Options<TContext>
>        : ^   ^^       ^^^^^                 
>arg : boolean
>    : ^^^^^^^

  return builder(true);
>builder(true) : Options<TContext>
>              : ^^^^^^^^^^^^^^^^^
>builder : (arg: boolean) => Options<TContext>
>        : ^   ^^       ^^^^^                 
>true : true
>     : ^^^^
}

create((arg: boolean) => ({
>create((arg: boolean) => ({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},})) : Options<{ time: Date; }>
>                                                                                                : ^^^^^^^^^^^^^^^^^^^^^^^^
>create : <TContext>(builder: (arg: boolean) => Options<TContext>) => Options<TContext>
>       : ^        ^^       ^^                                   ^^^^^^^^^^^^^^^^^^^^^^
>(arg: boolean) => ({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},}) : (arg: boolean) => { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                                        : ^   ^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>arg : boolean
>    : ^^^^^^^
>({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},}) : { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                      : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>{  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},} : { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  onStart: () => ({ time: new Date() }),
>onStart : () => { time: Date; }
>        : ^^^^^^^^^^^^^^^^^^^^^
>() => ({ time: new Date() }) : () => { time: Date; }
>                             : ^^^^^^^^^^^^^^^^^^^^^
>({ time: new Date() }) : { time: Date; }
>                       : ^^^^^^^^^^^^^^^
>{ time: new Date() } : { time: Date; }
>                     : ^^^^^^^^^^^^^^^
>time : Date
>     : ^^^^
>new Date() : Date
>           : ^^^^
>Date : DateConstructor
>     : ^^^^^^^^^^^^^^^

  onEnd: (context) => {},
>onEnd : (context: { time: Date; }) => void
>      : ^       ^^^^^^^^^^^^^^^^^^^^^^^^^^
>(context) => {} : (context: { time: Date; }) => void
>                : ^       ^^^^^^^^^^^^^^^^^^^^^^^^^^
>context : { time: Date; }
>        : ^^^^^^^^^^^^^^^

}));

create(() => ({
>create(() => ({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},})) : Options<{ time: Date; }>
>                                                                                    : ^^^^^^^^^^^^^^^^^^^^^^^^
>create : <TContext>(builder: (arg: boolean) => Options<TContext>) => Options<TContext>
>       : ^        ^^       ^^                                   ^^^^^^^^^^^^^^^^^^^^^^
>() => ({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},}) : () => { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                            : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},}) : { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                      : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>{  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},} : { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  onStart: () => ({ time: new Date() }),
>onStart : () => { time: Date; }
>        : ^^^^^^^^^^^^^^^^^^^^^
>() => ({ time: new Date() }) : () => { time: Date; }
>                             : ^^^^^^^^^^^^^^^^^^^^^
>({ time: new Date() }) : { time: Date; }
>                       : ^^^^^^^^^^^^^^^
>{ time: new Date() } : { time: Date; }
>                     : ^^^^^^^^^^^^^^^
>time : Date
>     : ^^^^
>new Date() : Date
>           : ^^^^
>Date : DateConstructor
>     : ^^^^^^^^^^^^^^^

  onEnd: (context) => {},
>onEnd : (context: { time: Date; }) => void
>      : ^       ^^^^^^^^^^^^^^^^^^^^^^^^^^
>(context) => {} : (context: { time: Date; }) => void
>                : ^       ^^^^^^^^^^^^^^^^^^^^^^^^^^
>context : { time: Date; }
>        : ^^^^^^^^^^^^^^^

}));

create((arg) => ({
>create((arg) => ({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},})) : Options<{ time: Date; }>
>                                                                                       : ^^^^^^^^^^^^^^^^^^^^^^^^
>create : <TContext>(builder: (arg: boolean) => Options<TContext>) => Options<TContext>
>       : ^        ^^       ^^                                   ^^^^^^^^^^^^^^^^^^^^^^
>(arg) => ({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},}) : (arg: boolean) => { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                               : ^   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>arg : boolean
>    : ^^^^^^^
>({  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},}) : { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                      : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>{  onStart: () => ({ time: new Date() }),  onEnd: (context) => {},} : { onStart: () => { time: Date; }; onEnd: (context: { time: Date; }) => void; }
>                                                                    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  onStart: () => ({ time: new Date() }),
>onStart : () => { time: Date; }
>        : ^^^^^^^^^^^^^^^^^^^^^
>() => ({ time: new Date() }) : () => { time: Date; }
>                             : ^^^^^^^^^^^^^^^^^^^^^
>({ time: new Date() }) : { time: Date; }
>                       : ^^^^^^^^^^^^^^^
>{ time: new Date() } : { time: Date; }
>                     : ^^^^^^^^^^^^^^^
>time : Date
>     : ^^^^
>new Date() : Date
>           : ^^^^
>Date : DateConstructor
>     : ^^^^^^^^^^^^^^^

  onEnd: (context) => {},
>onEnd : (context: { time: Date; }) => void
>      : ^       ^^^^^^^^^^^^^^^^^^^^^^^^^^
>(context) => {} : (context: { time: Date; }) => void
>                : ^       ^^^^^^^^^^^^^^^^^^^^^^^^^^
>context : { time: Date; }
>        : ^^^^^^^^^^^^^^^

}));

// https://github.com/microsoft/TypeScript/issues/57021

type Schema = Record<string, unknown>;
>Schema : Schema
>       : ^^^^^^

type StepFunction<TSchema extends Schema = Schema> = (anything: unknown) => {
>StepFunction : StepFunction<TSchema>
>             : ^^^^^^^^^^^^^^^^^^^^^
>anything : unknown
>         : ^^^^^^^

  readonly schema: TSchema;
>schema : TSchema
>       : ^^^^^^^

  readonly toAnswers?: (keys: keyof TSchema) => unknown;
>toAnswers : ((keys: keyof TSchema) => unknown) | undefined
>          : ^^    ^^             ^^^^^       ^^^^^^^^^^^^^
>keys : keyof TSchema
>     : ^^^^^^^^^^^^^

};

function step1<TSchema extends Schema = Schema>(
>step1 : <TSchema extends Schema = Schema>(stepVal: StepFunction<TSchema>) => StepFunction<TSchema>
>      : ^       ^^^^^^^^^      ^^^^^^^^^^^       ^^                     ^^^^^                     

  stepVal: StepFunction<TSchema>,
>stepVal : StepFunction<TSchema>
>        : ^^^^^^^^^^^^^^^^^^^^^

): StepFunction<TSchema> {
  return stepVal;
>stepVal : StepFunction<TSchema>
>        : ^^^^^^^^^^^^^^^^^^^^^
}

const stepResult1 = step1((_something) => ({
>stepResult1 : StepFunction<{ attribute: string; }>
>            : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>step1((_something) => ({  schema: {    attribute: "anything",  },  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },})) : StepFunction<{ attribute: string; }>
>                                                                                                                                                                                                                     : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>step1 : <TSchema extends Schema = Schema>(stepVal: StepFunction<TSchema>) => StepFunction<TSchema>
>      : ^       ^^^^^^^^^      ^^^^^^^^^^^       ^^                     ^^^^^                     
>(_something) => ({  schema: {    attribute: "anything",  },  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },}) : (_something: unknown) => { schema: { attribute: string; }; toAnswers: (keys: "attribute") => { test: "true"; }; }
>                                                                                                                                                                                                              : ^          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>_something : unknown
>           : ^^^^^^^
>({  schema: {    attribute: "anything",  },  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },}) : { schema: { attribute: string; }; toAnswers: (keys: "attribute") => { test: "true"; }; }
>                                                                                                                                                                                              : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>{  schema: {    attribute: "anything",  },  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },} : { schema: { attribute: string; }; toAnswers: (keys: "attribute") => { test: "true"; }; }
>                                                                                                                                                                                            : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  schema: {
>schema : { attribute: string; }
>       : ^^^^^^^^^^^^^^^^^^^^^^
>{    attribute: "anything",  } : { attribute: string; }
>                               : ^^^^^^^^^^^^^^^^^^^^^^

    attribute: "anything",
>attribute : string
>          : ^^^^^^
>"anything" : "anything"
>           : ^^^^^^^^^^

  },
  toAnswers: (keys) => {
>toAnswers : (keys: "attribute") => { test: "true"; }
>          : ^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>(keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  } : (keys: "attribute") => { test: "true"; }
>                                                                                                                                   : ^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>keys : "attribute"
>     : ^^^^^^^^^^^

    type Test = string extends typeof keys ? never : "true";
>Test : "true"
>     : ^^^^^^
>keys : "attribute"
>     : ^^^^^^^^^^^

    const test: Test = "true"; // ok
>test : "true"
>     : ^^^^^^
>"true" : "true"
>       : ^^^^^^

    return { test };
>{ test } : { test: "true"; }
>         : ^^^^^^^^^^^^^^^^^
>test : "true"
>     : ^^^^^^

  },
}));

type StepFunction2<TSchema extends Schema = Schema> = (anything: unknown) => {
>StepFunction2 : StepFunction2<TSchema>
>              : ^^^^^^^^^^^^^^^^^^^^^^
>anything : unknown
>         : ^^^^^^^

  readonly schema: (thing: number) => TSchema;
>schema : (thing: number) => TSchema
>       : ^     ^^      ^^^^^       
>thing : number
>      : ^^^^^^

  readonly toAnswers?: (keys: keyof TSchema) => unknown;
>toAnswers : ((keys: keyof TSchema) => unknown) | undefined
>          : ^^    ^^             ^^^^^       ^^^^^^^^^^^^^
>keys : keyof TSchema
>     : ^^^^^^^^^^^^^

};

function step2<TSchema extends Schema = Schema>(
>step2 : <TSchema extends Schema = Schema>(stepVal: StepFunction2<TSchema>) => StepFunction2<TSchema>
>      : ^       ^^^^^^^^^      ^^^^^^^^^^^       ^^                      ^^^^^                      

  stepVal: StepFunction2<TSchema>,
>stepVal : StepFunction2<TSchema>
>        : ^^^^^^^^^^^^^^^^^^^^^^

): StepFunction2<TSchema> {
  return stepVal;
>stepVal : StepFunction2<TSchema>
>        : ^^^^^^^^^^^^^^^^^^^^^^
}

const stepResult2 = step2((_something) => ({
>stepResult2 : StepFunction2<{ attribute: string; }>
>            : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>step2((_something) => ({  schema: (thing) => ({    attribute: "anything",  }),  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },})) : StepFunction2<{ attribute: string; }>
>                                                                                                                                                                                                                                  : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>step2 : <TSchema extends Schema = Schema>(stepVal: StepFunction2<TSchema>) => StepFunction2<TSchema>
>      : ^       ^^^^^^^^^      ^^^^^^^^^^^       ^^                      ^^^^^                      
>(_something) => ({  schema: (thing) => ({    attribute: "anything",  }),  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },}) : (_something: unknown) => { schema: (thing: number) => { attribute: string; }; toAnswers: (keys: "attribute") => { test: "true"; }; }
>                                                                                                                                                                                                                           : ^          ^^^^^^^^^^^^^^^^^^^^^^^^^     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>_something : unknown
>           : ^^^^^^^
>({  schema: (thing) => ({    attribute: "anything",  }),  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },}) : { schema: (thing: number) => { attribute: string; }; toAnswers: (keys: "attribute") => { test: "true"; }; }
>                                                                                                                                                                                                           : ^^^^^^^^^^^     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>{  schema: (thing) => ({    attribute: "anything",  }),  toAnswers: (keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  },} : { schema: (thing: number) => { attribute: string; }; toAnswers: (keys: "attribute") => { test: "true"; }; }
>                                                                                                                                                                                                         : ^^^^^^^^^^^     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  schema: (thing) => ({
>schema : (thing: number) => { attribute: string; }
>       : ^     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>(thing) => ({    attribute: "anything",  }) : (thing: number) => { attribute: string; }
>                                            : ^     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>thing : number
>      : ^^^^^^
>({    attribute: "anything",  }) : { attribute: string; }
>                                 : ^^^^^^^^^^^^^^^^^^^^^^
>{    attribute: "anything",  } : { attribute: string; }
>                               : ^^^^^^^^^^^^^^^^^^^^^^

    attribute: "anything",
>attribute : string
>          : ^^^^^^
>"anything" : "anything"
>           : ^^^^^^^^^^

  }),
  toAnswers: (keys) => {
>toAnswers : (keys: "attribute") => { test: "true"; }
>          : ^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>(keys) => {    type Test = string extends typeof keys ? never : "true";    const test: Test = "true"; // ok    return { test };  } : (keys: "attribute") => { test: "true"; }
>                                                                                                                                   : ^    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>keys : "attribute"
>     : ^^^^^^^^^^^

    type Test = string extends typeof keys ? never : "true";
>Test : "true"
>     : ^^^^^^
>keys : "attribute"
>     : ^^^^^^^^^^^

    const test: Test = "true"; // ok
>test : "true"
>     : ^^^^^^
>"true" : "true"
>       : ^^^^^^

    return { test };
>{ test } : { test: "true"; }
>         : ^^^^^^^^^^^^^^^^^
>test : "true"
>     : ^^^^^^

  },
}));

